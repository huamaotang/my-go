# 变量
- var 声明语句可以创建一个特定类型的变量，然后给变量附加一个名字，并且设置变量的初始值
```
var 变量名字 类型 = 表达式
```
- 其中"类型"或"= 表达式"可以省略其中一个，如果省略的是类型信息，那么将根据初始化表达式来推导变量的类型
- 如果初始化表达式被省略，将用零值初始化该变量。数值类型的零值为0，布尔类型零值是false，字符串零值是空字符串，接口或引用类型
（包括slice、指针、map、chan、func）变量零值是nil，数组或结构体等聚合类型零值是每个元素或字段都是对应类型的零值
- 零值初始化机制可以确保每个声明的变量总是有一个良好定义的值，而且可以在没有增加额外工作的前提下确保边界条件下的合理行为
- 应该让一些聚合类型的零值也具有意义，这样可以保证不管任何类型的变量总是有一个合理有效的零值状态
- 也可以在一个声明语句中同时声明一组变量，或用一组初始化表达式声明并初始化一组变量
- 包级别声明的变量会在main入口函数执行前完成初始化

## 短变量声明
- ":="是变量声明语句，"="是变量赋值操作
- 短变量声明的变量可能并不是全部都是刚刚声明的，如果已经在相同的词法域声明过了，对这些变量就只有赋值行为
- 短变量声明必须最少声明一个新变量

## 指针
- 每一个变量必然有对应的内存地址，通过指针可以读取或者更新对应变量的值
```
x := 1
p := &x         // p, of type *int, points to x
fmt.Println(*p) // "1"
*p = 2          // equivalent to x = 2
fmt.Println(x)  // "2"
```

- 聚合类型每个成员，如结构体的每个字段、或是数组的每个元素，也都是对应的一个变量，可以被取地址
- 变量有时候被称为可寻址的值
- 任何指针类型的零值都是nil
- Go语言中，返回函数中局部变量的地址也是安全的。局部变量地址被返回后依然有效，因为指针p依然引用这个地址
```
var p = f()

func f() *int {
    v := 1
    return &v
}
```

## new函数
- new函数类似是一中语法糖，而不是一个新的基础概念
- new函数使用相对较少，对于结构体来说，直接用字面量语法创建新变量的方法会更灵活
- new不是一个关键字，而是一个内置函数，可以作为变量的名字。当被当作变量名使用时，相同词法域内不再能使用new函数

## 变量的声明周期
- 程序运行期间变量有效存在的时间段
- 包级别变量生命周期和整个程序的运行周期一致
- 局部变量的生命周期则是动态的：每次从创建一个新变量的声明开始，直到该变量不再被引用为止，然后变量的存储空间可能被回收
- 函数的参数变量和返回值变量都是局部变量，它们在函数每次被调用的时候创建
- Go语言的自动垃圾收集器是如何知道一个变量是何时可以被回收的呢？
    - 基本思路：从每个包级别的变量和每个当前运行函数的每一个局部变量开始，通过指针或引用的访问路径遍历，检查是否可以找到变量
    如果不存在这样的访问路径，说明该变量是不可达的，可以回收
    - 因为一个变量的有效周期只取决于是否可达，因此一个循环迭代内部的变量的生命周期可能超出其局部作用域（x变量需要在循环迭代完成之后，
    原有的变量才会被回收）。
    同时，局部变量可能在函数返回之后依然
    存在（x变量从f函数中逃逸了）
        ```
        var global *int
        
        func f() {
            var x int
            x = 1
            global = &x
        }
        
        func g() {
            y := new(int)
            *y = 1
        }
        ```
        ```
        for t := 0.0; t < cycles*2*math.Pi; t += res {
            x := math.Sin(t)
            y := math.Sin(t*freq + phase)
            img.SetColorIndex(
                size+int(x*size+0.5), size+int(y*size+0.5),
                blackIndex, // 最后插入的逗号不会导致编译错误，这是Go编译器的一个特性
            )               // 小括弧另起一行缩进，和大括弧的风格保存一致
        }
        ```
    